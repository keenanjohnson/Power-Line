<!DOCTYPE html>
<html>
    <head>
        <title>Open Home Automation</title>
        <script>
        function GetArduinoInputs()
        {
            var request = new XMLHttpRequest();
            request.onreadystatechange = function()
            {
                if (this.readyState == 4) {
                    if (this.status == 200) {
                        if (this.responseXML != null) {
                            // extract XML data from XML file (containing light states)
							var count_var = this.responseXML.getElementsByTagName('count')[0].childNodes[0].nodeValue;
							
                            // Get main body of HTML document
                            document.getElementById("input_app").innerHTML = "";

                            var input_section = document.getElementById("input_app");
							
                            var node_count = 0;

                            // Loop for each light reported by base station
							for( var i = 1; i <= 5; i++ ) {
                                if(this.responseXML.getElementsByTagName("light" + i).length > 0)
                                {
									node_count++;
									
	                                // Create new device element
									var element = document.createElement("BUTTON");

                                    // Change button style
                                    element.style.width = "200px";
                                    element.style.height = "100px";
                                    element.style.fontSize = "large";

	                                //Add label to button
	                                var label = "Light" + i;
	                                var but_label = document.createTextNode(label);
	                                element.id = label;
	                                element.appendChild(but_label);
                                
	                                // Set state of light
	                                if(this.responseXML.getElementsByTagName("light" + i)[0].childNodes[0].nodeValue  == "ON")
	                                {
	                                    // Set button to green
	                                    element.style.backgroundColor = "#00FF00";
	                                }
	                                else
	                                {
	                                    // Set button to red
	                                    element.style.backgroundColor = "#FF0000";
	                                }

	                                // Add click callback funtion
	                                element.onclick = buttonClick;

								    //Append the element in page (in span).
								    input_section.appendChild(element);
								}
								
                                if(node_count==count_var)
                                {
                                    break;
                                }
							}
                        }
                    }
                }
            }

            // Send the status update request
            request.open("GET", "Status", true);
            request.send(null);

            // Delay to periodically send status
            // requests to base station
            setTimeout('GetArduinoInputs()', 1000);
        }

        // Call back for button presses
        function buttonClick()
        {
            // New HTTP Post
            var request = new XMLHttpRequest();
-           request.open("POST", "", true);

            // Post contains the Id number of the light
            // .slice(-1) retuns last character of the light 
            // ID string
-           request.send(this.id.slice(-1));
        }

    </script>
    
    </head>
    <body onload="GetArduinoInputs()">
        <h1>Unified &amp Open Home Automation</h1>
		<p><span id="input_app">Updating...</span></p>
    </body>
</html>